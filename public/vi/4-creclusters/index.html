<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Tạo Workload Cluster :: Kubernetes Multi-Cluster Management với Cluster API</title>

    
    <link href="/css/nucleus.css?1754751022" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1754751022" rel="stylesheet">
    <link href="/css/hybrid.css?1754751022" rel="stylesheet">
    <link href="/css/featherlight.min.css?1754751022" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1754751022" rel="stylesheet">
    <link href="/css/auto-complete.css?1754751022" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1754751022" rel="stylesheet">
    <link href="/css/theme.css?1754751022" rel="stylesheet">
    <link href="/css/hugo-theme.css?1754751022" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1754751022" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1754751022"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/4-creclusters/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1754751022"></script>
<script type="text/javascript" src="/js/auto-complete.js?1754751022"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1754751022"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-prerequiste/" title="Các bước chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/">
           <b> 2. </b> Các bước chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.1-awscli/" title="Cài đặt và cấu hình AWS CLI" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.1-awscli/">
           <b> 2.1 </b> Cài đặt và cấu hình AWS CLI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-tools/" title="Cài đặt công cụ" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.2-tools/">
           <b> 2.2 </b> Cài đặt công cụ
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-tools/2.2.1-kubectl/" title="Kubectl (CLI cho Kubernet)" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.2-tools/2.2.1-kubectl/">
           <b> 2.2.1 </b> Kubectl (CLI cho Kubernet)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-tools/2.2.2-eksctl/" title="Eksctl (CLI cho Amazon EKS)" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.2-tools/2.2.2-eksctl/">
           <b> 2.2.2 </b> Eksctl (CLI cho Amazon EKS)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-tools/2.2.3-clusterctl/" title="Clusterctl (CLI cho Cluster API)" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.2-tools/2.2.3-clusterctl/">
           <b> 2.2.3 </b> Clusterctl (CLI cho Cluster API)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-tools/2.2.4.clusterawsadm/" title="Clusterawsadm" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.2-tools/2.2.4.clusterawsadm/">
           <b> 2.2.4 </b> Clusterawsadm
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-tools/2.2.5-kind/" title="Kind" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.2-tools/2.2.5-kind/">
           <b> 2.2.5 </b> Kind
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-tools/docker/" title="Docker" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.2-tools/docker/">
           <b> 2.2.6 </b> Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.3-creec2keypair/" title="Tạo EC2 Keypair" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.3-creec2keypair/">
           <b> 2.3 </b> Tạo EC2 Keypair
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.4-cres3/" title="Tạo S3 Bucket" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/2.4-cres3/">
           <b> 2.4 </b> Tạo S3 Bucket
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-iniclusters/" title="Khởi tạo Cluster API quản lý cluster" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-iniclusters/">
           <b> 3. </b> Khởi tạo Cluster API quản lý cluster
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-creclusters/" title="Tạo Workload Cluster" class="dd-item 
        
        active
        
        ">
      <a href="/vi/4-creclusters/">
           <b> 4. </b> Tạo Workload Cluster
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-networking/" title="Thiết lập Cross-Cluster Networking" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-networking/">
           <b> 5. </b> Thiết lập Cross-Cluster Networking
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-distribution/" title="Phân phối Workload" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-distribution/">
           <b> 6. </b> Phân phối Workload
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/7-security/" title="Triển khai quản trị và bảo mật" class="dd-item 
        
        
        
        ">
      <a href="/vi/7-security/">
           <b> 7. </b> Triển khai quản trị và bảo mật
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/8-cost/" title="Quản lý chi phí" class="dd-item 
        
        
        
        ">
      <a href="/vi/8-cost/">
           <b> 8. </b> Quản lý chi phí
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/9-procedures/" title="Quy trình vận hành" class="dd-item 
        
        
        
        ">
      <a href="/vi/9-procedures/">
           <b> 9. </b> Quy trình vận hành
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/10-cleanup/" title="Dọn dẹp tài nguyên  " class="dd-item 
        
        
        
        ">
      <a href="/vi/10-cleanup/">
          <b>10. </b>Dọn dẹp tài nguyên  
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/4-creclusters/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/4-creclusters/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>30-07-2025</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> 
                <a href="https://www.linkedin.com/in/nguyentung1812/"  style="color:orange">Nguyễn Thanh Tùng  </a> <br>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/vi/'>Kubernetes Multi-Cluster Management với Cluster API</a> > Tạo Workload Cluster
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#tạo-manifest-cho-cụm-kubernetes">Tạo Manifest cho Cụm Kubernetes</a></li>
    <li><a href="#cài-đặt-argo-cd-trên-cụm-quản-lý-kubernetes">Cài đặt Argo CD trên Cụm Quản lý Kubernetes</a>
      <ul>
        <li><a href="#tạo-cụm-workload">Tạo Cụm Workload</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Tạo Workload Cluster
            </h1>
          

        



	<h2 id="tạo-manifest-cho-cụm-kubernetes">Tạo Manifest cho Cụm Kubernetes</h2>
<ol>
<li><strong>Tạo khóa SSH</strong>:</li>
</ol>
<pre tabindex="0"><code>aws ec2 create-key-pair --key-name capi-eks --region ap-southeast-2 --query &#39;KeyMaterial&#39; --output text &gt; capi-eks.pem
aws ec2 create-key-pair --key-name capi-ec2 --region us-east-1 --query &#39;KeyMaterial&#39; --output text &gt; capi-ec2.pem
</code></pre><ol start="2">
<li><strong>Xác định các biến môi trường</strong>:</li>
</ol>
<pre tabindex="0"><code>export AWS_CONTROL_PLANE_MACHINE_TYPE=t3.medium
export AWS_NODE_MACHINE_TYPE=t3.medium
</code></pre><ol start="3">
<li><strong>Tạo Manifest cho Cụm Kubernetes trên EC2</strong>:</li>
</ol>
<pre tabindex="0"><code>export AWS_SSH_KEY_NAME=capi-ec2
export AWS_REGION=us-east-1 
clusterctl generate cluster capi-ec2 --kubernetes-version v1.31.0 --control-plane-machine-count=3 --worker-machine-count=3 &gt; ./capi-cluster/aws-ec2/aws-ec2.yaml
</code></pre><ol start="4">
<li><strong>Tạo Manifest cho Cụm Kubernetes trên EKS</strong>:</li>
</ol>
<pre tabindex="0"><code>export AWS_SSH_KEY_NAME=capi-eks
export AWS_REGION=ap-southeast-2
clusterctl generate cluster capi-eks --flavor eks-managedmachinepool --kubernetes-version v1.31.0 --worker-machine-count=3 &gt; ./capi-cluster/aws-eks/capi-eks.yaml
</code></pre><h2 id="cài-đặt-argo-cd-trên-cụm-quản-lý-kubernetes">Cài đặt Argo CD trên Cụm Quản lý Kubernetes</h2>
<p><strong>Cài đặt Argo CD trong cụm quản lý Kind</strong>:</p>
<pre tabindex="0"><code>kubectl apply -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</code></pre><p><strong>Lấy mật khẩu đăng nhập lần đầu cho giao diện web Argo CD</strong>:</p>
<pre tabindex="0"><code>kubectl get secret argocd-initial-admin-secret -o jsonpath=&#34;{.data.password}&#34; | base64 -d; echo
</code></pre><p><strong>Cấu hình xác thực Argo CD với Git</strong>:</p>
<ul>
<li>
<p><strong>Đăng nhập vào cổng web của Argo CD</strong>:</p>
<pre tabindex="0"><code>kubectl port-forward svc/argocd-server 8080:80
</code></pre><ul>
<li>Tên người dùng: admin</li>
<li>Mật khẩu: <code>mật khẩu đăng nhập lần đầu</code><br>
<img src="/images/4.workload/001-workload.png" alt="workload"></li>
</ul>
</li>
<li>
<p>Điều hướng đến Cài đặt &gt; Kho lưu trữ &gt; Kết nối kho lưu trữ:</p>
<ul>
<li>Chọn phương thức kết nối: HTTP/HTTPS</li>
<li>Loại: Git</li>
<li>URL kho lưu trữ: URL của kho lưu trữ đã fork</li>
<li>Chọn <code>bỏ qua xác minh máy chủ</code><br>
<img src="/images/4.workload/003-workload.png" alt="workload"><br>
<img src="/images/4.workload/002-workload.png" alt="workload"></li>
</ul>
</li>
<li>
<p>Kết nối</p>
</li>
</ul>
<h3 id="tạo-cụm-workload">Tạo Cụm Workload</h3>
<p><strong>Để ủy quyền cho Argo CD quản lý các đối tượng Cluster API, tạo ClusterRoleBinding để cấp quyền cần thiết cho tài khoản dịch vụ <code>argocd-application-controller</code>, sử dụng vai trò <code>cluster-admin</code> cho đơn giản</strong>:</p>
<pre tabindex="0"><code>kubectl apply -f ./management/argo-cluster-role-binding.yaml
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cluster-admin-argocd-contoller</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">argocd-application-controller</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cluster-admin</span>
</span></span></code></pre></div><h4 id="tạo-cụm-workload-cho-kubernetes-chạy-trên-ec2">Tạo Cụm Workload cho Kubernetes chạy trên EC2:</h4>
<p>Để tạo cụm EKS mới hoặc cụm Kubernetes chạy trên EC2, trước tiên định nghĩa một ứng dụng theo cách khai báo, đại diện cho tập hợp các manifest Kubernetes để triển khai cụm mới. Trong hướng dẫn này, tất cả cấu hình ứng dụng Argo CD được lưu trong thư mục “Management” của kho lưu trữ đã sao chép. Ví dụ, dưới đây là tệp manifest ứng dụng để tạo cụm Kubernetes chạy trên EC2:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">argoproj.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Application</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ec2-cluster</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">destination</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#39;default&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#e6db74">&#39;https://kubernetes.default.svc&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">source</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">capi-cluster/aws-ec2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repoURL</span>: <span style="color:#e6db74">&#39;[cập nhật URL kho lưu trữ Git tương ứng]&#39;</span> <span style="color:#75715e">#Chỉ định kho lưu trữ nguồn để lấy cấu hình cụm</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetRevision</span>: <span style="color:#ae81ff">HEAD</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project</span>: <span style="color:#ae81ff">default</span> <span style="color:#75715e">#Có thể đặt tên dự án tại đây</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">automated</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">prune</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">allowEmpty</span>: <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>Sau khi sửa đổi tệp YAML ứng dụng Argo CD như trên, commit và đẩy các thay đổi lên kho lưu trữ nguồn:</p>
<pre tabindex="0"><code>git push .
git add .
git commit -m “cập nhật tệp manifest ứng dụng Argo CD” 
</code></pre><p>Chạy lệnh sau để tạo một ứng dụng mới nhằm tạo cụm Kubernetes chạy trên EC2:</p>
<pre tabindex="0"><code>kubectl apply -f ./management/argocd-ec2-app.yaml
</code></pre><p>Sử dụng ứng dụng Argo CD để cung cấp cụm EKS. Đầu tiên, tạo một ứng dụng và cập nhật tệp YAML liên quan để đặt <code>repoURL</code> thành kho lưu trữ Git của bạn. Sau đó, commit và đẩy các thay đổi lên kho lưu trữ nguồn.</p>
<pre tabindex="0"><code>kubectl apply -f ./management/argocd-eks-app.yaml
</code></pre><p><strong>Kiểm tra trạng thái của các cụm</strong>:</p>
<pre tabindex="0"><code>clusterctl describe cluster capi-eks
clusterctl describe cluster capi-ec2
</code></pre><p>Cụm EC2 hiển thị trạng thái READY của các node công việc là &ldquo;False&rdquo; do không có CNI, khiến các node không tham gia vào cụm. Để minh họa, triển khai Calico CNI vào cụm EC2, có thể tự động hóa bằng Argo CD.</p>
<p><strong>Lấy tệp kubeconfig cho cụm mới tạo trên EC2</strong>:</p>
<pre tabindex="0"><code>clusterctl get kubeconfig capi-ec2 &gt; capikubeconfig-ec2
</code></pre><p><strong>Triển khai Calico CNI</strong>:</p>
<pre tabindex="0"><code>kubectl --kubeconfig=./capikubeconfig-ec2 apply -f https://docs.projectcalico.org/v3.21/manifests/calico.yaml
</code></pre><p>Calico CNI được triển khai thành công, kiểm tra lại trạng thái cụm.</p>
<p>Khi tạo cụm EKS, hệ thống tự động tạo và lưu trữ các tệp kubeconfig dưới dạng bí mật (secret) trong cụm quản lý. Hành vi này khác với việc tạo cụm không được quản lý bằng nhà cung cấp AWS, nơi kubeconfig không được lưu trữ theo cách này. Bí mật chứa kubeconfig sẽ được đặt tên là <code>[tên-cụm]-user-kubeconfig</code>, trong đó thay <code>[tên-cụm]</code> bằng tên thực tế của cụm.</p>
<p>Để lấy kubeconfig người dùng cho cụm có tên ‘capi-eks’, chạy lệnh sau:</p>
<pre tabindex="0"><code>kubectl --namespace=default get secret capi-eks-user-kubeconfig -o jsonpath={.data.value} | base64 --decode &gt; capikubeconfig-eks
</code></pre>




<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/3-iniclusters/" title="Khởi tạo Cluster API quản lý cluster"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/5-networking/" title="Thiết lập Cross-Cluster Networking" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1754751022"></script>
    <script src="/js/perfect-scrollbar.min.js?1754751022"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1754751022"></script>
    <script src="/js/jquery.sticky.js?1754751022"></script>
    <script src="/js/featherlight.min.js?1754751022"></script>
    <script src="/js/highlight.pack.js?1754751022"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1754751022"></script>
    <script src="/js/learn.js?1754751022"></script>
    <script src="/js/hugo-learn.js?1754751022"></script>

    <link href="/mermaid/mermaid.css?1754751022" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1754751022"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
